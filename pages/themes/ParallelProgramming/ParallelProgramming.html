<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>ParallelProgramming</title>
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

	<link rel="shortcut icon" type="image/jpg" href="/PythonCourseNetIT-Slides/favicon.png"/>

	<!-- css & themes include -->
	<link rel="stylesheet" href="/PythonCourseNetIT-Slides/lib/reveal.js/css/reveal.css">
	<link rel="stylesheet" href="/PythonCourseNetIT-Slides/outfit/css/themes/light.css" id="theme">
	<!-- Printing and PDF exports -->
	<script>
		var link = document.createElement( 'link' );
		link.rel = 'stylesheet';
		link.type = 'text/css';
		link.href = window.location.search.match( /print-pdf/gi ) ? '/PythonCourseNetIT-Slides/lib/reveal.js/css/print/pdf.css' : '/PythonCourseNetIT-Slides/lib/reveal.js/css/print/paper.css';
		document.getElementsByTagName( 'head' )[0].appendChild( link );
	</script>
	<!--[if lt IE 9]>
	<script src="lib/js/html5shiv.js"></script>
	<![endif]-->
	<!-- CUSTOM -->
	<base target="_blank">
</head>
<body>
	<div class="reveal default center" data-transition-speed="default" data-background-transition="default">
		<div class="top_links">
			<a class="home_link" href="/PythonCourseNetIT-Slides/pages/agenda/agenda.html#ParallelProgramming" target="_top"></a>
			<span class="help_link"><i class="fa fa-question"></i></span>
			<div class="help_text">
        <div><span>N/Space</span><span>next slide</span></div>
        <div><span>P</span><span>previous slide</span></div>
        <div><span>O</span><span>overview slides</span></div>
        <div><span>ctrl+left click</span><span>zoom element</span></div>
      </div>
		</div>
		<div class="footer theme_switch">
			<a href="#" onclick="document.getElementById('theme').setAttribute('href','/PythonCourseNetIT-Slides/outfit/css/themes/dark.css'); return false;">Dark</a>
			<a href="#" onclick="document.getElementById('theme').setAttribute('href','/PythonCourseNetIT-Slides/outfit/css/themes/light.css'); return false;">Light</a>
			<a href="#" onclick="document.getElementById('theme').setAttribute('href','/PythonCourseNetIT-Slides/outfit/css/themes/projector.css'); return false;">Projector</a>
		</div>
		<div class="slides">
<!--
########################################################
##################### SLIDES START #####################
########################################################
-->
<section><h1>Parallel programming: multithreading and multiprocessing</h1></section>
<section data-transition="zoom">
	<!-- linkedin badge -->

	<section class="copyright" data-transition="zoom">
		<div class="note">
			<p>Created for</p>
		</div>
		<div class="company">
			<a href="https://softwareacademy.bg//програмиране-с-python-2/">
			<img style="height:80%" src="/PythonCourseNetIT-Slides/outfit/images/logos/software-web@4x.png" alt="software-web@4x.png">
			</a>
		</div>
	</section>
	<!-- <section class="copyright" data-transition="zoom" style="margin-top: -2em;">
		<div class="company">
			 <div class="LI-profile-badge"  data-version="v1" data-size="large" data-locale="en_US" data-type="vertical" data-theme="dark" data-vanity="ivapopova"><a class="LI-simple-link" href='https://bg.linkedin.com/in/ivapopova?trk=profile-badge'>Iva E. Popova on LinkedIn</a></div>
		</div>
	</section> -->
</section>

<section><h1>Shape the concepts</h1></section>
<section><h2>Shape the concepts</h2>
	<section><h3>Multitasking</h3>
		<a href="images/driver_multitasking.jpg"><img src="images/driver_multitasking.jpg"></a>
		<a href="images/driver_multitasking_diagram.png"><img src="images/driver_multitasking_diagram.png"></a>
	</section>
	<section><h3>Multitasking</h3>
		<dl class="fa">
			<dt>Multitasking is implemented in Python by threading and multiprocessing.</dt>
			<dt>A hot topic, in the contest of rapid increase of the number of cores in contemporary microprocessors.</dt>
		</dl>
	</section>
 	<section><h3>Von Neumann Architecture</h3>
		<a href="./images/Computer_Systems_-_Von_Neumann_Architecture_Large_poster_anchor_chart.svg"><img src="./images/Computer_Systems_-_Von_Neumann_Architecture_Large_poster_anchor_chart.svg" alt="_Von_Neumann_Architecture_Large_poster_anchor_chart.svg"></a>
	</section>
	<section><h3>Multi Core Processor</h3>
		<a href="./images/Block-Diagram-of-Single-core-and-Multi-core-Processor.png"><img src="./images/Block-Diagram-of-Single-core-and-Multi-core-Processor.png" alt="Block-Diagram-of-Single-core-and-Multi-core-Processor.png"></a>
	</section>
	<section><h3>Check CPU details</h3>
		<p>Linux:</p>
		<pre><code rel="Terminal" class="bash">
			lscpu | head -10
		</code></pre>
		<p>Windows: </p>
		<p><a href="https://support.microsoft.com/en-us/windows/find-out-how-many-cores-your-processor-has-3126ef99-0247-33b3-81fc-065e9fb0c35b#:~:text=Press%20Ctrl%20%2B%20Shift%20%2B%20Esc%20to,logical%20processors%20your%20PC%20has.">Find out how many cores your processor has @support.microsoft.com</a></p>
		<p>Pyhton:</p>
		<pre><code rel="check_CPU_cores.py" class="bash">
			import os

			print('core count: ', os.cpu_count())
		</code></pre>
	</section>
	<section><h3>Preliminary</h3>
		<dl class="fa">
			<dt>N <span class="note">cores</span> ==  N physical <span class="note">Central Processing Units(CPU)</span> leaving in one chip.</dt>
			<dt><span class="note">threads</span> are something virtual. Multithreading performance is increased by logic for splitting tasks between hardware resources.</dt>
			<dt>Hyper-Threading Technology - to make OS to "see" more CPUs than the real physical units are.</dt>
		</dl>
	</section>
	<section><h3>Threads vs Processes</h3>
		<a href="images/MultiThreadingStorage.png"><img src="images/MultiThreadingStorage.png"></a>
	</section>
	<section><h3>Threads vs Processes</h3>
		<a href="images/Processes.png"><img src="images/Processes.png"></a>
	</section>
	<section><h3>Threads vs Processes</h3>
		<dl class="fa">
			<dt>Memory:</dt>
			<dd>A Process has its own individual memory segment, not shareable with other process. <span class="note">Inter process communication</span> techniques are applied in order for process to share data</dd>
			<dd>Threads <span class="note">share same memory</span>. </dd>
			<dt>A Thread lives in a Process. One Process can run multiple Threads. </dt>
			<dt>A python process has at least one thread - for the main program.</dt>
			<dt>Parallelism in Python (GIL note)</dt>
			<dd class="note">Only one thread can be executed at a time!</dd>
			<dd class="note">Multiple processes can work simultaneous on different cores.</dd>
		</dl>
	</section>
</section>


<section><h1>Thread-based parallelism</h1></section>
<section><h2>Thread-based parallelism</h2>
	<section><h3>Multithreading in Python</h3>
		<dl class="fa">
			<dt><a href="https://docs.python.org/3/library/threading.html">threading</a> module is the preferred way in Python for thread-based "parallelism" (a note about GIL!)</dt>
			<dt>A thread is created by the <code class="note">Thread</code> class constructor.</dt>
			<dt>Once created, the thread could be started my <code class="note">start()</code> method</dt>
			<dt>Other threads can call a thread’s <code class="note">join()</code> method. This blocks the calling thread until the thread whose join() method is called is terminated</dt>
		</dl>
	</section>
	<section><h3>Creating Thread objects</h3>
		<pre><code rel="Syntax" class="python">
			tr_obj = threading.Thread(target=None, name=None, args=(), kwargs={}, daemon=None)
		</code></pre>
		<dl class="fa" style="font-size: .8em">
			<dt><code class="note">target</code> - function to be run in a thread</dt>
			<dt><code>name</code> is the thread name. By default, a unique name is constructed of the form "Thread-N" where N is a small decimal number</dt>
			<dt><code class="note">args</code> is the argument <b>tuple</b> for the target invocation</dt>
			<dt><code>kwargs</code> is a dictionary of keyword arguments for the target invocation</dt>
			<dt><code>daemon</code> -  if not None, a daemonic thread will be created.</dt>
			<dd style="font-size: .8em">A non-daemon thread blocks the main program to exit if they are not dead. Daemonic thread do not prevent the main program to exit, and will be killed by the main process when exiting.</dd>
		</dl>
	</section>

	<section><h3>Creating and running thread - example</h3>
		<pre><code rel="simlplest.py" class="python">
			import threading
			import time


			def worker(x):
				tid = threading.currentThread().name;
				print(f"Work started in thread {tid}")
				time.sleep(5)
				print(f"Work ended in thread {tid}")

			# create the tread
			tr = threading.Thread(target=worker, args=(42,))

			# start the thread:
			tr.start()

			# wait until thread terminates:
			tr.join()

			print("Worker did its job!")
		</code></pre>
	</section>
	<section><h3>Sequential vs multithreaded processing</h3>
		<pre><code rel="sequential_vs_multithreaded_noneCPUbound.py" class="python">
			import threading
			import time

			def worker(x):
				tid = threading.currentThread().name

				# do some hard and time consuming work:
				time.sleep(2)
				print(f"Worker {tid} is working with {x}")


			#################################################
			# Sequential Processing:
			#################################################
			t = time.time()
			worker(42)
			worker(84)
			print("Sequential Processing took:",time.time() - t,"\n")

			#################################################
			# Multithreaded Processing:
			#################################################
			tmulti = time.time()
			tr1 = threading.Thread(target=worker, args=(42,))
			tr2 = threading.Thread(target=worker, args=(82,))

			tr1.start();tr2.start()
			tr1.join(); tr2.join()
			print("Multithreaded Processing took:",time.time() - tmulti)
		</code></pre>
		<p>You can enjoy the speed of multithreading in Python, <span class="note">if the threaded workers are not CPU intensive.</span></p>
	</section>
	<section><h3 class="advanced">GIL - the Global Interpreter Lock</h3>
		<dl class="fa">
			<dt>GIL is a mechanism which prevents simultaneous working of multiple thread. So, Python's GIL prevents the "real" parallel multitasking mechanism, and instead implements a <em>cooperative and preemptive multitasking</em>.</dt>
			<dt><a href="https://wiki.python.org/moin/GlobalInterpreterLock">GIL @wiki.python.org</a></dt>
		</dl>
	</section>
	<section><h3>The GIL effect - example</h3>
		<dl class="fa">
			<dt>In CPU intensive task, <span class="note">multithreading is slower</span> than sequential single-thread processing!</dt>
		</dl>
		<pre><code rel="sequential_vs_multithreaded_CPUbound.py" class="python">
			import threading
			import time

			max_range = 10_000_000
			max_range_half = max_range//2

			def worker(r):
				tid = threading.currentThread().name

				# do some hard and time consuming work:
				global result
				res = 0

				for i in r:
					res += i

				result += res
				print("Worker {tid} is working with {r}")


			#################################################
			# Sequential Processing:
			#################################################
			t = time.time()
			result = 0

			worker(range(max_range_half))
			worker(range(max_range_half, max_range))

			print("Sequential Processing result: ", result)
			print("Sequential Processing took:",time.time() - t,"\n")

			#################################################
			# Multithreaded Processing:
			#################################################
			t = time.time()
			result = 0

			tr1 = threading.Thread(target=worker, args=(range(max_range_half),))
			tr2 = threading.Thread(target=worker, args=(range(max_range_half,max_range),))

			tr1.start();tr2.start()
			tr1.join(); tr2.join()

			print("Multithreaded Processing result: ", result)
			print("Multithreaded Processing took:",time.time() - t,"\n")
		</code></pre>
	</section>
</section>


<section><h1>References</h1></section>
<section><h2>References</h2>
	<section><h3>Readings</h3>
		<dl class="fa">
			<dt><a href="https://medium.com/practo-engineering/threading-vs-multiprocessing-in-python-7b57f224eadb">Threading vs Multiprocessing in Python by Pawan Pundir</a></dt>
			<dt><a href="https://opensource.com/article/17/4/grok-gil">Grok the GIL: How to write fast and thread-safe Python</a></dt>
		</dl>
	</section>
	<section><h3>Videos</h3>
		<dl class="fa">
			<dt><a href="https://www.youtube.com/playlist?list=PLeo1K3hjS3uub3PRhdoCTY8BxMKSW7RjN">Python Multithreading/Multiprocessing</a> -  6 videos on theme by <a href="https://www.youtube.com/channel/UCh9nVJoWXmFb7sLApWGcLPQ">codebasics</a></dt>
		</dl>
	</section>
</section>

<!--
<section id="hw"><h1>Exercises</h1></section>
<section><h2>Task1</h2>
	<section><h3>The Task</h3>

	</section>
</section> -->

<!-- <section><h3>Submission</h3>
	<dl class="fa">
		<dt>Please, prefix your filenames/archive with your name initials, before sending.</dt>
		<dd>For instance: <b>iep_task1.py</b> or <b>iep_tasks.rar</b></dd>
		<dt>Send files to <a href="mailto:ivawebcourses@gmail.com?Subject=HW: ParallelProgramming">ivawebcourses@gmail.com</a></dt>
	</dl>
</section> -->



<section class="disclaimer" data-background="/PythonCourseNetIT-Slides/outfit/images/for_slides/the_end_on_sand.jpg">
	 <p>These slides are based on</p>
	 <p>customized version of </p>
	 <p><a href="http://hakim.se/">Hakimel</a>'s <a href="http://lab.hakim.se/reveal-js">reveal.js</a></p>
	 <p>framework</p>
</section>
<!--
########################################################
##################### SLIDES END   #####################
########################################################
-->
		</div>
	</div>
	<!-- Custom processing -->
	<script src="/PythonCourseNetIT-Slides/outfit/js/slides.js"></script>
	<!-- external scripts -->
	<script src="/PythonCourseNetIT-Slides/lib/reveal.js/lib/js/head.min.js"></script>
	<script src="/PythonCourseNetIT-Slides/lib/reveal.js/js/reveal.js"></script>
	 <!-- init reveal -->
	<script>
		// Full list of configuration options available at:
		// https://github.com/hakimel/reveal.js#configuration
		var highlightjsTabSize = '  ';
		Reveal.initialize({
			controls: true,
			progress: true,
			slideNumber: 'c/t',
			keyboard: true,
			history: true,
			center: true,
			width: 1024,
			height: 850,
			// Bounds for smallest/largest possible scale to apply to content
			// minScale: .5,
			maxScale: 1,
			// slide transition
			transition: 'concave', // none/fade/slide/convex/concave/zoom
			// Factor of the display size that should remain empty around the content
			margin: 0.1,
			// shift+left click to zoom in/out element
			zoomKey: 'ctrl',
			// theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
			// transition: Reveal.getQueryHash().transition || 'default'
			// Optional reveal.js plugins
			dependencies: [
				{ src: '/PythonCourseNetIT-Slides/lib/reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
				{ src: '/PythonCourseNetIT-Slides/lib/reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
				{ src: '/PythonCourseNetIT-Slides/lib/reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
				{ src: '/PythonCourseNetIT-Slides/lib/reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.configure({tabReplace: highlightjsTabSize}); hljs.initHighlightingOnLoad(); } },
				{ src: '/PythonCourseNetIT-Slides/lib/reveal.js/plugin/zoom-js/zoom.js', async: true },
				{ src: '/PythonCourseNetIT-Slides/lib/reveal.js/plugin/notes/notes.js', async: true }
			]
		});
	</script>
</body>
</html>
